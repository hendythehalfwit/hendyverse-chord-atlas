<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>hendyverse chord atlas — offline</title>
<style>
  :root{
    --bg:#0b0f14; --fg:#eef2f7;
    --glass1: rgba(16,67,94,0.35);
    --glass2: rgba(8,62,41,0.28);
    --glass3: rgba(112,63,20,0.35);
    --border: rgba(255,255,255,0.1);
  }
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
  .wrap{max-width:1200px;margin:0 auto;padding:20px;}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px;}
  .title{font-weight:700;font-size:20px;letter-spacing:.02em}
  .chip{border:1px solid var(--border);background:rgba(255,255,255,0.05);padding:6px 10px;border-radius:999px;font-size:12px;color:#cbd5e1}
  select,input{background:rgba(255,255,255,0.06);border:1px solid var(--border);color:var(--fg);border-radius:10px;padding:8px 10px;font-size:14px;outline:none}
  input{width:220px}
  .panel{border:1px solid var(--border);border-radius:16px;padding:14px;background:linear-gradient(90deg,var(--glass1),var(--glass2),var(--glass3));box-shadow:0 12px 30px rgba(0,0,0,0.35), inset 0 0 60px rgba(255,255,255,0.05)}
  .foot{display:flex;gap:14px;flex-wrap:wrap;font-size:12px;color:#9fb0c2;margin-top:8px;align-items:center;justify-content:space-between}
  .legend{display:flex;gap:8px;align-items:center}
  .dot{width:10px;height:10px;border-radius:50%}
  .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace}
</style>
</head>
<body>
  <div class="wrap">
    <div class="row">
      <div class="title">the <span style="text-transform:lowercase">hendy</span>verse chord atlas — <span style="color:#facc6b">offline</span></div>
      <div class="row" style="gap:8px">
        <label>
          <select id="mood">
            <option value="frozen">frozen</option>
            <option value="dream">dream</option>
            <option value="drift" selected>drift</option>
            <option value="fire">fire</option>
            <option value="resolve">resolve</option>
            <option value="collapse">collapse</option>
          </select>
        </label>
        <label>
          <select id="key">
            <option>C</option><option>C#</option><option>D</option><option>D#</option><option>E</option><option>F</option>
            <option>F#</option><option>G</option><option>G#</option><option>A</option><option>A#</option><option>B</option>
          </select>
        </label>
        <input id="search" placeholder="find chord (e.g., Aadd9)"/>
      </div>
    </div>

    <div class="panel">
      <svg id="stage" viewBox="0 0 1600 520" style="width:100%;height:460px;">
        <defs>
          <radialGradient id="glow" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="#fff" stop-opacity="0.9"/>
            <stop offset="60%" stop-color="#fff" stop-opacity="0.12"/>
            <stop offset="100%" stop-color="#fff" stop-opacity="0"/>
          </radialGradient>
          <linearGradient id="band-frozen" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#63e0ff" stop-opacity="0.25"/>
            <stop offset="100%" stop-color="#63e0ff" stop-opacity="0.05"/>
          </linearGradient>
          <linearGradient id="band-dream" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#a591ff" stop-opacity="0.25"/>
            <stop offset="100%" stop-color="#a591ff" stop-opacity="0.05"/>
          </linearGradient>
          <linearGradient id="band-drift" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#6fffd0" stop-opacity="0.25"/>
            <stop offset="100%" stop-color="#6fffd0" stop-opacity="0.05"/>
          </linearGradient>
          <linearGradient id="band-fire" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#ffd166" stop-opacity="0.25"/>
            <stop offset="100%" stop-color="#ffd166" stop-opacity="0.05"/>
          </linearGradient>
          <linearGradient id="band-resolve" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#ff9b5e" stop-opacity="0.25"/>
            <stop offset="100%" stop-color="#ff9b5e" stop-opacity="0.05"/>
          </linearGradient>
          <linearGradient id="band-collapse" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#ff6b6b" stop-opacity="0.25"/>
            <stop offset="100%" stop-color="#ff6b6b" stop-opacity="0.05"/>
          </linearGradient>
        </defs>
      </svg>
      <div class="foot">
        <div class="legend"><div class="dot" style="background:#ffd782"></div><div>gold arcs = suggested motion</div></div>
        <div class="mono" style="opacity:.7" id="iivii">ii–V–I: —</div>
        <div class="mono" style="opacity:.7">sector 19.84 • currents not cages</div>
      </div>
    </div>
  </div>

<script>
(function(){
  const ROOTS = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
  const ZONES = [
    { id:"frozen",  color:"#63e0ff" },
    { id:"dream",   color:"#a591ff" },
    { id:"drift",   color:"#6fffd0" },
    { id:"fire",    color:"#ffd166" },
    { id:"resolve", color:"#ff9b5e" },
    { id:"collapse",color:"#ff6b6b" },
  ];
  const CHORD_TYPES = {
    frozen:  [{s:"m"},{s:"m7"},{s:"m(add9)"},{s:"dim"},{s:"m7b5"}],
    dream:   [{s:"maj7"},{s:"maj9"},{s:"maj7#11"},{s:"6/9"},{s:"m11"}],
    drift:   [{s:"6"},{s:"add9"},{s:"sus2"},{s:"sus4"},{s:"m7"}],
    fire:    [{s:"7"},{s:"9"},{s:"13"},{s:"7b9"},{s:"7#9"},{s:"+"},{s:"7sus4"}],
    resolve: [{s:""},{s:"maj7"},{s:"6"},{s:"add9"}],
    collapse:[{s:"7alt"},{s:"dim7"},{s:"7b13"},{s:"7#11"},{s:"7b9"}],
  };
  const ZONE_EDGES = {
    frozen:["dream","collapse"],
    dream:["drift","fire"],
    drift:["fire","resolve"],
    fire:["resolve","collapse"],
    resolve:["drift","dream"],
    collapse:["resolve","frozen"],
  };

  const stage = document.getElementById('stage');
  const moodSel = document.getElementById('mood');
  const keySel = document.getElementById('key');
  const searchInput = document.getElementById('search');
  const iivii = document.getElementById('iivii');

  const width = 1600, height = 520, zoneWidth = width / ZONES.length;

  function majorScale(tonic){
    const idx = ROOTS.indexOf(tonic);
    const steps = [0,2,4,5,7,9,11].map(s => (idx+s)%12);
    return steps.map(i => ROOTS[i]);
  }

  function rng(seed){
    let h=0; for(let i=0;i<seed.length;i++) h=((h*31)+seed.charCodeAt(i))>>>0;
    return ()=> (h=(h*1664525+1013904223)>>>0, (h%1000)/1000);
  }

  // draw zone bands
  ZONES.forEach((z,i)=>{
    const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
    rect.setAttribute("x", (width/ZONES.length)*i);
    rect.setAttribute("y", 0);
    rect.setAttribute("width", width/ZONES.length);
    rect.setAttribute("height", height);
    rect.setAttribute("fill", `url(#band-${z.id})`);
    stage.appendChild(rect);

    const label = document.createElementNS("http://www.w3.org/2000/svg","text");
    label.setAttribute("x", (width/ZONES.length)*(i+0.5));
    label.setAttribute("y", 24);
    label.setAttribute("text-anchor","middle");
    label.setAttribute("fill","rgba(255,255,255,0.7)");
    label.style.letterSpacing = "0.2em";
    label.style.fontSize = "12px";
    label.textContent = z.id;
    stage.appendChild(label);
  });

  // build nodes
  const nodes=[]; const edges=[];
  ZONES.forEach((zone,zi)=>{
    const jitter = rng(zone.id);
    const x0 = zi*zoneWidth + zoneWidth*0.1;
    const x1 = (zi+1)*zoneWidth - zoneWidth*0.1;
    const yTop = 70, yBot = height - 60;
    const types = CHORD_TYPES[zone.id] || [];
    ROOTS.forEach((root,ri)=>{
      types.forEach((t,ti)=>{
        const sym = t.s;
        const label = (zone.id==="resolve" && sym==="") ? root : root+sym;
        const id = label+"-"+zone.id;
        const x = x0 + (x1-x0)*(0.15 + 0.7*jitter(id));
        const y = yTop + (yBot-yTop)*((ri + (ti+1)/(types.length+1))/(ROOTS.length+1));
        nodes.push({id,label,zone:zone.id,root,x,y});
      });
    });
  });

  // edges (suggested zone motion, prefer same-root target)
  nodes.forEach(n=>{
    (ZONE_EDGES[n.zone]||[]).forEach(z=>{
      const candidates = nodes.filter(m=>m.zone===z && m.root===n.root);
      const target = candidates[0] || nodes.find(m=>m.zone===z);
      if(target) edges.push({from:n.id,to:target.id});
    });
  });

  // draw edges
  const edgeEls = edges.map((e)=>{
    const a = nodes.find(n=>n.id===e.from);
    const b = nodes.find(n=>n.id===e.to);
    const path = document.createElementNS("http://www.w3.org/2000/svg","path");
    path.setAttribute("d", `M ${a.x} ${a.y} C ${(a.x+b.x)/2} ${a.y-40}, ${(a.x+b.x)/2} ${b.y+40}, ${b.x} ${b.y}`);
    path.setAttribute("fill","none");
    path.setAttribute("stroke","rgba(255,215,130,0.25)");
    path.setAttribute("stroke-width","1.1");
    stage.appendChild(path);
    return {el:path, a, b};
  });

  // draw nodes
  const nodeEls = nodes.map((n)=>{
    const g = document.createElementNS("http://www.w3.org/2000/svg","g");
    const glow = document.createElementNS("http://www.w3.org/2000/svg","circle");
    glow.setAttribute("cx", n.x); glow.setAttribute("cy", n.y);
    glow.setAttribute("r", 0); glow.setAttribute("fill", "url(#glow)");
    glow.setAttribute("opacity","0");
    const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("cx", n.x); c.setAttribute("cy", n.y); c.setAttribute("r", 10);
    c.setAttribute("fill", "#0b0f14");
    c.setAttribute("stroke", ZONES.find(z=>z.id===n.zone).color);
    c.setAttribute("stroke-width", 2);
    const t = document.createElementNS("http://www.w3.org/2000/svg","text");
    t.setAttribute("x", n.x); t.setAttribute("y", n.y-16);
    t.setAttribute("text-anchor","middle"); t.setAttribute("fill","rgba(255,255,255,0.9)");
    t.style.fontSize = "10px"; t.textContent = n.label;

    g.appendChild(glow); g.appendChild(c); g.appendChild(t);
    stage.appendChild(g);
    return {g, glow, c, t, data:n};
  });

  function setHover(id){
    nodeEls.forEach(ne=>{
      const on = ne.data.id===id;
      ne.glow.setAttribute("r", on?24:0);
      ne.glow.setAttribute("opacity", on?0.25:0);
      ne.c.setAttribute("stroke-width", on?3:2);
    });
    edgeEls.forEach(e=>{
      const on = (e.a.id===id || e.b.id===id);
      e.el.setAttribute("stroke", `rgba(255,215,130,${on?0.9:0.25})`);
      e.el.setAttribute("stroke-width", on?2.2:1.1);
    });
  }

  nodeEls.forEach(ne=>{
    ne.g.addEventListener("mouseenter",()=>setHover(ne.data.id));
    ne.g.addEventListener("mouseleave",()=>setHover(null));
  });

  // mood highlight + search + ii–V–I
  function applyFilters(){
    const mood = moodSel.value;
    const q = searchInput.value.toLowerCase().trim();
    nodeEls.forEach(ne=>{
      const moodOn = ne.data.zone===mood;
      const searchOn = q? ne.data.label.toLowerCase().includes(q) : true;
      const opacity = (moodOn || searchOn) ? 1 : 0.2;
      ne.g.style.opacity = opacity;
    });
  }

  function updateII(){
    const k = keySel.value;
    const scale = majorScale(k);
    const ii = scale[1] + "m7", V = scale[4] + "7", I = scale[0] + "maj7";
    iivii.textContent = `ii–V–I in ${k}: ${ii} → ${V} → ${I}`;
  }

  moodSel.addEventListener("change", applyFilters);
  searchInput.addEventListener("input", applyFilters);
  keySel.addEventListener("change", updateII);

  applyFilters(); updateII();
})();
</script>
</body>
</html>
